---
title: ngx_http_rewrite_module
description: ngx_http_rewrite_module
toc: true
nd-org-source: http/ngx_http_rewrite_module.xml
nd-plus: false
nd-partial-plus: false
---


<!--
      ********************************************************************************
      üõë WARNING: AUTOGENERATED FILE - DO NOT EDIT üõë This Markdown file was
      automatically generated from the source XML documentation. Any manual
      changes made directly to this file will be overwritten. To request or
      suggest changes, please edit the source XML files instead.
      https://github.com/nginx/nginx.org/tree/main/xml/en
      ********************************************************************************
      -->


The `ngx_http_rewrite_module` module is used to
change request URI using PCRE regular expressions, return redirects, and
conditionally select configurations.

The [](#break), [](#if), [](#return),
[](#rewrite), and [](#set) directives are
processed in the following order:

- the directives of this module specified on the [server](/nginx/module-reference/http/ngx_http_core_module#server) level are executed sequentially;
- repeatedly: 
- a [location](/nginx/module-reference/http/ngx_http_core_module#location) is searched based on a request URI;
- the directives of this module specified inside the found location are executed sequentially;
- the loop is repeated if a request URI was [rewritten](#rewrite) , but not more than [10 times](/nginx/module-reference/http/ngx_http_core_module#internal) .



## Directives

### break

{{< call-out >}}

**Syntax:** break 

**Default:** -

**Context:** server, location, if


{{</call-out>}}


Stops processing the current set of
`ngx_http_rewrite_module` directives.

If a directive is specified inside the
[location](/nginx/module-reference/http/ngx_http_core_module#location),
further processing of the request continues in this location.

Example:

```nginx
if ($slow) {
    limit_rate 10k;
    break;
}

```

### if

{{< call-out >}}

**Syntax:** if ( `condition` )

**Default:** -

**Context:** server, location


{{</call-out>}}


The specified `condition` is evaluated.
If true, this module directives specified inside the braces are
executed, and the request is assigned the configuration inside the
`if` directive.
Configurations inside the `if` directives are
inherited from the previous configuration level.

A condition may be any of the following:

- a variable name; false if the value of a variable is an empty string or ‚Äú `0` ‚Äù; 
Before version 1.0.1, any string starting with ‚Äú`0`‚Äù
was considered a false value.

- comparison of a variable with a string using the ‚Äú `=` ‚Äù and ‚Äú `!=` ‚Äù operators;
- matching of a variable against a regular expression using the ‚Äú `~` ‚Äù (for case-sensitive matching) and ‚Äú `~*` ‚Äù (for case-insensitive matching) operators. Regular expressions can contain captures that are made available for later reuse in the `$1` .. `$9` variables. Negative operators ‚Äú `!~` ‚Äù and ‚Äú `!~*` ‚Äù are also available. If a regular expression includes the ‚Äú `}` ‚Äù or ‚Äú `;` ‚Äù characters, the whole expressions should be enclosed in single or double quotes.
- checking of a file existence with the ‚Äú `-f` ‚Äù and ‚Äú `!-f` ‚Äù operators;
- checking of a directory existence with the ‚Äú `-d` ‚Äù and ‚Äú `!-d` ‚Äù operators;
- checking of a file, directory, or symbolic link existence with the ‚Äú `-e` ‚Äù and ‚Äú `!-e` ‚Äù operators;
- checking for an executable file with the ‚Äú `-x` ‚Äù and ‚Äú `!-x` ‚Äù operators.


Examples:

```nginx
if ($http_user_agent ~ MSIE) {
    rewrite ^(.*)$ /msie/$1 break;
}

if ($http_cookie ~* "id=([^;]+)(?:;|$)") {
    set $id $1;
}

if ($request_method = POST) {
    return 405;
}

if ($slow) {
    limit_rate 10k;
}

if ($invalid_referer) {
    return 403;
}

```


A value of the `$invalid_referer` embedded variable is set by the
[valid_referers](/nginx/module-reference/http/ngx_http_referer_module#valid_referers) directive.
### return

{{< call-out >}}

**Syntax:** return `code` [ `text` ]

**Syntax:** return `code` `URL`

**Syntax:** return `URL`

**Default:** -

**Context:** server, location, if


{{</call-out>}}


Stops processing and returns the specified `code` to a client.
The non-standard code 444 closes a connection without sending
a response header.

Starting from version 0.8.42, it is possible to specify
either a redirect URL (for codes 301, 302, 303, 307, and 308)
or the response body `text` (for other codes).
A response body text and redirect URL can contain variables.
As a special case, a redirect URL can be specified as a URI
local to this server, in which case the full redirect URL
is formed according to the request scheme (`$scheme`) and the
[server_name_in_redirect](/nginx/module-reference/http/ngx_http_core_module#server_name_in_redirect) and
[port_in_redirect](/nginx/module-reference/http/ngx_http_core_module#port_in_redirect) directives.

In addition, a `URL` for temporary redirect with the code 302
can be specified as the sole parameter.
Such a parameter should start with the ‚Äú`http://`‚Äù,
‚Äú`https://`‚Äù, or ‚Äú`$scheme`‚Äù string.
A `URL` can contain variables.

Only the following codes could be returned before version 0.7.51:
204, 400, 402¬†‚Äî 406, 408, 410, 411, 413, 416, and 500¬†‚Äî 504.

The code 307 was not treated as a redirect until versions 1.1.16 and 1.0.13.

The code 308 was not treated as a redirect until version 1.13.0.

See also the [error_page](/nginx/module-reference/http/ngx_http_core_module#error_page) directive.
### rewrite

{{< call-out >}}

**Syntax:** rewrite `regex` `replacement` [ `flag` ]

**Default:** -

**Context:** server, location, if


{{</call-out>}}


If the specified regular expression matches a request URI, URI is changed
as specified in the `replacement` string.
The `rewrite` directives are executed sequentially
in order of their appearance in the configuration file.
It is possible to terminate further processing of the directives using flags.
If a replacement string starts with ‚Äú`http://`‚Äù,
‚Äú`https://`‚Äù, or ‚Äú`$scheme`‚Äù,
the processing stops and the redirect is returned to a client.

An optional `flag` parameter can be one of:
`last`
stops processing the current set of
`ngx_http_rewrite_module` directives and starts
a search for a new location matching the changed URI;
`break`
stops processing the current set of
`ngx_http_rewrite_module` directives
as with the [](#break) directive;
`redirect`
returns a temporary redirect with the 302 code;
used if a replacement string does not start with
‚Äú`http://`‚Äù, ‚Äú`https://`‚Äù,
or ‚Äú`$scheme`‚Äù;
`permanent`
returns a permanent redirect with the 301 code.

The full redirect URL is formed according to the
request scheme (`$scheme`) and the
[server_name_in_redirect](/nginx/module-reference/http/ngx_http_core_module#server_name_in_redirect) and
[port_in_redirect](/nginx/module-reference/http/ngx_http_core_module#port_in_redirect) directives.

Example:

```nginx
server {
    ...
    rewrite ^(/download/.*)/media/(.*)\..*$ $1/mp3/$2.mp3 last;
    rewrite ^(/download/.*)/audio/(.*)\..*$ $1/mp3/$2.ra  last;
    return  403;
    ...
}

```


But if these directives are put inside the ‚Äú`/download/`‚Äù
location, the `last` flag should be replaced by
`break`, or otherwise nginx will make 10 cycles and
return the 500 error:

```nginx
location /download/ {
    rewrite ^(/download/.*)/media/(.*)\..*$ $1/mp3/$2.mp3 break;
    rewrite ^(/download/.*)/audio/(.*)\..*$ $1/mp3/$2.ra  break;
    return  403;
}

```


If a `replacement` string includes the new request arguments,
the previous request arguments are appended after them.
If this is undesired, putting a question mark at the end of a replacement
string avoids having them appended, for example:

```nginx
rewrite ^/users/(.*)$ /show?user=$1? last;

```


If a regular expression includes the ‚Äú`}`‚Äù
or ‚Äú`;`‚Äù characters, the whole expressions should be enclosed
in single or double quotes.
### rewrite_log

{{< call-out >}}

**Syntax:** rewrite_log `on` | `off`

**Default:** off

**Context:** http, server, location, if


{{</call-out>}}


Enables or disables logging of `ngx_http_rewrite_module`
module directives processing results
into the [error_log](/nginx/module-reference/../ngx_core_module#error_log) at
the `notice` level.
### set

{{< call-out >}}

**Syntax:** set `$variable` `value`

**Default:** -

**Context:** server, location, if


{{</call-out>}}


Sets a `value` for the specified `variable`.
The `value` can contain text, variables, and their combination.
### uninitialized_variable_warn

{{< call-out >}}

**Syntax:** uninitialized_variable_warn `on` | `off`

**Default:** on

**Context:** http, server, location, if


{{</call-out>}}


Controls whether warnings about uninitialized variables are logged.
## Internal Implementation


The `ngx_http_rewrite_module` module directives
are compiled at the configuration stage into internal instructions
that are interpreted during request processing.
An interpreter is a simple virtual stack machine.

For example, the directives

```nginx
location /download/ {
    if ($forbidden) {
        return 403;
    }

    if ($slow) {
        limit_rate 10k;
    }

    rewrite ^/(download/.*)/media/(.*)\..*$ /$1/mp3/$2.mp3 break;
}

```


will be translated into these instructions:

```nginx
variable $forbidden
check against zero
    return 403
    end of code
variable $slow
check against zero
match of regular expression
copy "/"
copy $1
copy "/mp3/"
copy $2
copy ".mp3"
end of regular expression
end of code

```


Note that there are no instructions for the
[limit_rate](/nginx/module-reference/http/ngx_http_core_module#limit_rate)
directive above as it is unrelated to the
`ngx_http_rewrite_module` module.
A separate configuration is created for the [](#if) block.
If the condition holds true, a request is assigned this configuration
where `limit_rate` equals to 10k.

The directive

```nginx
rewrite ^/(download/.*)/media/(.*)\..*$ /$1/mp3/$2.mp3 break;

```


can be made smaller by one instruction if the first slash in the regular expression
is put inside the parentheses:

```nginx
rewrite ^(/download/.*)/media/(.*)\..*$ $1/mp3/$2.mp3 break;

```


The corresponding instructions will then look like this:

```nginx
match of regular expression
copy $1
copy "/mp3/"
copy $2
copy ".mp3"
end of regular expression
end of code

```

