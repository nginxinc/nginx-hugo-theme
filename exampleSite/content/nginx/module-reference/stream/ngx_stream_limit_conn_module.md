---
title: ngx_stream_limit_conn_module
description: ngx_stream_limit_conn_module
toc: true
nd-org-source: stream/ngx_stream_limit_conn_module.xml
nd-plus: false
nd-partial-plus: false
---


<!--
********************************************************************************
ðŸ›‘ WARNING: AUTOGENERATED FILE - DO NOT EDIT ðŸ›‘
This Markdown file was automatically generated from the source XML documentation.
Any manual changes made directly to this file will be overwritten.
To request or suggest changes, please edit the source XML files instead.
https://github.com/nginx/nginx.org/tree/main/xml/en
********************************************************************************
-->


The `ngx_stream_limit_conn_module` module (1.9.3) is used to
limit the number of connections per the defined key, in
particular, the number of connections from a single IP address.
## Example Configuration


```nginx
stream {
    limit_conn_zone $binary_remote_addr zone=addr:10m;

    ...

    server {

        ...

        limit_conn           addr 1;
        limit_conn_log_level error;
    }
}

```

## Directives

### limit_conn

{{< call-out >}}

**Syntax:** limit_conn `zone` `number`

**Default:** -

**Context:** stream, server


{{</call-out>}}


Sets the shared memory zone
and the maximum allowed number of connections for a given key value.
When this limit is exceeded, the server will close the connection.
For example, the directives

```nginx
limit_conn_zone $binary_remote_addr zone=addr:10m;

server {
    ...
    limit_conn addr 1;
}

```


allow only one connection per an IP address at a time.

When several `limit_conn` directives are specified,
any configured limit will apply.

These directives are inherited from the previous configuration level
if and only if there are no `limit_conn` directives
defined on the current level.
### limit_conn_dry_run

{{< call-out >}}

**Syntax:** limit_conn_dry_run `on` | `off`

**Default:** off

**Context:** stream, server

_This directive appeared in version 1.17.6._


{{</call-out>}}


Enables the dry run mode.
In this mode, the number of connections is not limited, however,
in the shared memory zone, the number of excessive connections is accounted
as usual.
### limit_conn_log_level

{{< call-out >}}

**Syntax:** limit_conn_log_level `info` | `notice` | `warn` | `error`

**Default:** error

**Context:** stream, server


{{</call-out>}}


Sets the desired logging level for cases when the server
limits the number of connections.
### limit_conn_zone

{{< call-out >}}

**Syntax:** limit_conn_zone `key` `zone` = `name` : `size`

**Default:** -

**Context:** stream


{{</call-out>}}


Sets parameters for a shared memory zone
that will keep states for various keys.
In particular, the state includes the current number of connections.
The `key` can contain text, variables,
and their combinations (1.11.2).
Connections with an empty key value are not accounted.
Usage example:

```nginx
limit_conn_zone $binary_remote_addr zone=addr:10m;

```


Here, the key is a client IP address set by the
`$binary_remote_addr` variable.
The size of `$binary_remote_addr`
is 4 bytes for IPv4 addresses or 16 bytes for IPv6 addresses.
The stored state always occupies 32 or 64 bytes
on 32-bit platforms and 64 bytes on 64-bit platforms.
One megabyte zone can keep about 32 thousand 32-byte states
or about 16 thousand 64-byte states.
If the zone storage is exhausted, the server will close the connection.

Additionally, as part of our
commercial subscription,
the
[status information](/nginx/module-reference/../http/ngx_http_api_module#stream_limit_conns_)
for each such shared memory zone can be
[obtained](/nginx/module-reference/../http/ngx_http_api_module#getStreamLimitConnZone) or
[reset](/nginx/module-reference/../http/ngx_http_api_module#deleteStreamLimitConnZoneStat)
with the [API](/nginx/module-reference/../http/ngx_http_api_module) since 1.17.7.
## Embedded Variables

`$limit_conn_status`
keeps the result of limiting the number of connections (1.17.6):
`PASSED`,
`REJECTED`, or
`REJECTED_DRY_RUN`