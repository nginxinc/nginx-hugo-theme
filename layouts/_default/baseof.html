<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">

<head>

  {{ block "head" . }}

  {{ partial "meta.html" . }}

  {{ partial "favicon.html" . }}

  {{ partial "styles.html" . }}

  {{ if in .Params.doctypes "devportal" }}
  {{ partial "devportal/style.html" . }}
  {{ end }}

  {{ if fileExists "/layouts/partials/head_custom.html" }}
  {{ partial "head_custom.html" . }}
  {{ end }}

  {{ if or ( not hugo.IsServer ) ( not ( in .Site.Params.buildtype "package" ) ) }}

  {{ partial "trustarc.html" . }}

  {{ partial "tealium-profile.html" . }}

  {{ end }}

  {{ end }}

  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-K5HG9JT');</script>

  <script>
  let storedTheme = null;
  try {
    storedTheme = localStorage.getItem('theme');
  } catch (e) {
    console.warn('Unable to read theme from localStorage:', e);
  }

  const mql = window.matchMedia?.('(prefers-color-scheme: dark)');
  const initialTheme = storedTheme || (mql?.matches ? 'dark' : 'light');
  document.documentElement.setAttribute('data-theme', initialTheme);

  document.addEventListener('DOMContentLoaded', () => {
    const toggle = document.getElementById('theme-toggle');
    if (!toggle) return;

    toggle.addEventListener('click', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);
      try {
        localStorage.setItem('theme', newTheme);
      } catch (e) {
        console.warn('Failed to write theme to localStorage:', e);
      }
    });

    const hasUserChoice = storedTheme !== null;

    if (!hasUserChoice && mql) {
      const onSystemChange = (e) => {
        try {
          if (localStorage.getItem('theme') !== null) return;
        } catch (err) {
          console.warn('Unable to read theme from localStorage:', err);
        }
        const theme = e.matches ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', theme);
      };
      mql.addEventListener('change', onSystemChange);
    }
  });

  window.addEventListener('storage', (e) => {
    if (e.key !== 'theme') return;
    const theme = e.newValue || (mql?.matches ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', theme);
  });

  </script>
  </head>

  <body id="body">
    {{ if or ( not hugo.IsServer ) ( not ( in .Site.Params.buildtype "package" ) ) }}
    {{ partial "universal-tag.html" . }}
    {{ end }}
    <input type="checkbox" id="sidebar-panel" class="sidebar-panel" hidden/>
    <div class="grid-container">
        <aside class="sidebar">
            {{ partial "sidebar-v2.html" . }}
        </aside>

        <header class="header">
            {{ block "header" . }}{{end}}
        </header>

        {{ block "main" . }}{{ end }}

        <footer class="footer">
          {{ block "footer-v2" . }}
            {{ partial "footer-v2.html" . }}
          {{ end }}
        </footer>
    </div>


  {{ partial "scripts.html" . }}
  <div id="consent_blackbar"></div>
</body>
</html>
