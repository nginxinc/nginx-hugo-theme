
<div class="sidebar__container">
    <div class="sidebar__header" data-testid="sidebar__header">
        <div class="sidebar__search">
          <!-- Standalone search box. -->
          {{ partial "coveo-atomic-search.html" (dict "id" "search-standalone-sidebar") }}
          <label class="sidebar__mobile__toggle" for="sidebar-panel">
              {{ partial "lucide" (dict "context" . "icon" "panel-left-close") }}
          </label>
        </div>

        <!-- Normalize our URL path to handle preview environments                 -->
        {{ $rawPath := strings.TrimPrefix .Site.BaseURL .Permalink }}
        {{ $normalizedPath := printf "/%s" $rawPath }}

        {{ $currentProductTitle := "" }}

        {{ with index .Site.Data "product-selector" }}
          {{ range $group := . }}
            {{ range $product := $group.products }}
              {{ if not $product.extUrl }}
                {{ $escaped := replace $product.url "/" "\\/" }}
                {{ $pattern := printf "/(%s)/" $escaped }}
                {{ if strings.FindRE $pattern $normalizedPath }}
                  {{ $currentProductTitle = $product.title }}
                {{ end }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}



        <div class="product-selector" data-testid="product-selector">
            <details class="product-selector__section">
                <summary class="product-selector__toggle">

                    <span class="product-selector__toggle-text">
                        {{ if $currentProductTitle }}
                            {{ $currentProductTitle }}
                        {{ else }}
                        Product Documentation
                        {{ end }}
                    </span>
                    <span class="product-selector__chevron">
                      {{ partial "lucide" (dict "context" . "icon" "chevron-right") }}
                    </span>
                </summary>
                <div class="product-selector__content">
                {{ with index .Site.Data "product-selector" }}
                  {{ $groups := . }}
                  {{ range $group := $groups }}
                    <h3 class="product-selector__product-group">{{ $group.productGroup }}</h3>
                    <ul>
                      {{ $products := sort $group.products "productOrder" }}
                      {{ range $product := $products }}
                        <li class="product-selector__product">
                          <a
                            href="{{ absURL $product.url }}"
                            aria-label="{{ $product.title }} documentation"
                            {{ if $product.extUrl }} target="_blank" {{ end }}
                          >
                            {{ $product.title }}
                          </a>
                        </li>
                      {{ end }}
                    </ul>
                  {{ end }}
                {{ else }}

                  <p>Could not find the data.</p>
                {{ end }}
                </div>

            </details>

        </div>

    </div>
    <div class="sidebar__content__wrapper">

        <div class="sidebar__content" data-testid="sidebar__content">
            <a class="skip-link" href="#maincontent">Skip Navigation</a>
            {{ partial "sidebar-list.html" (dict
            "firstSection" .FirstSection
            "currentUrl" .Permalink
            "currentPage" .
            "idPrefix" ""
          ) }}
        </div>
    </div>

</div>
