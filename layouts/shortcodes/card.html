{{- $title := .Get "title" -}}
{{- $titleUrl := .Get "titleUrl" | default "." -}}
{{- $icon := .Get "icon" | default "book-open" -}}
{{- $brandIcon := .Get "brandIcon" -}}
{{- $isFullSizeParam := .Get "isFullSize" | default "false" -}}
{{- $isLandingParam := .Get "isLanding" | default "false" }}

{{- /* Validate the parameter strictly */ -}}
{{- if not (in (slice "true" "false") $isFullSizeParam) -}}
  {{- warnf "The '<card>' Shortcode parameter 'isFullSize' must be 'true' or 'false', but got: '%s'. This will now default to 'false'" $isFullSizeParam -}}
{{- end -}}
{{- $isFullSize := cond (eq $isFullSizeParam "true") "true" "false" -}}

{{- if not (in (slice "true" "false") $isLandingParam) -}}
  {{- warnf "The '<card>' Shortcode parameter 'isLanding' must be 'true' or 'false', but got: '%s'. This will now default to 'false'" $isLandingParam -}}
{{- end -}}
{{- $isLanding := cond (eq $isLandingParam "true") "true" "false" -}}

{{- /* Set up the positioning */ -}}
{{- $dataGrid := "" -}}
{{- if eq $isFullSize "true" -}}
  {{- $dataGrid = "wide" -}}
{{- else if (eq $isLanding "true") -}}
  {{- $dataGrid = "third" -}}
{{- else -}}
  {{- $dataGrid = "half" -}}
{{- end -}}

{{- /* Build the url */ -}}
{{- $url := printf "%s%s" .Page.Permalink $titleUrl -}}
{{- if eq (substr $titleUrl 0 1) "/" -}}
  {{- $url = printf "%s%s" .Site.BaseURL (substr $titleUrl 1) -}}
{{- else if (strings.Contains $titleUrl "https") -}}
  {{- $url = $titleUrl -}}
{{- end -}}

{{- /* Validate that the parent is card-section and under 3 cards */ -}}
{{- if (eq .Parent.Name "card-section") -}}
<a href="{{- $url -}}" alt="{{- $title -}}" class="card" data-grid="{{ $dataGrid }}" data-testid="card">
  <div class="card-container">
    {{- if $title -}}
      <div class="card-header">
        {{- if $brandIcon -}}
          {{ with printf "images/icons/%s" $brandIcon }}
          <img class="card-brand-icon" src="{{. | absURL}}">
          {{ end }}
        {{- else if $icon -}}
          {{ partial "lucide" (dict "context" . "icon" $icon) }}
        {{- end -}}
        <h2 class="card-title">{{- $title -}}</h2>
      </div>
    {{- else -}}
      {{ errorf "Mainframe: Missing param 'title'" }}
    {{- end -}}
    {{- with .Inner -}}
    <div class="card-content">{{ . }}</div>
    {{- end -}}
  </div>
</a>
{{- else -}}
  {{ errorf "The '<card>' must be nested directly inside the shortcode '<card-section>'. Please see the exampleSite for an example of usage." }}
{{- end -}}
