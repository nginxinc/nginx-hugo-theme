{{- $title := .Get "title" -}}
{{- $titleUrl := .Get "titleUrl" | default "/" -}} 
{{- $icon := .Get "icon" | default "book-open" -}}
{{- $brandIcon := .Get "brandIcon" -}}
{{- $isFeaturedParam := .Get "isFeatured" | default "false" }}
{{- /* Validate the parameter strictly */ -}}
{{- if not (in (slice "true" "false") $isFeaturedParam) -}}
  {{- warnf "The '<card>' Shortcode parameter 'isFeatured' must be 'true' or 'false', but got: '%s'. This will now default to 'false'" $isFeaturedParam -}}
{{- end -}}
{{- $isFeatured := cond (eq $isFeaturedParam "true") "true" "false" -}}
{{- $current := .Page.Scratch.Get "cards" | default (slice) -}}
{{- $newCard := dict "title" ($title) "content" (.Inner) -}}
{{- .Page.Scratch.Set "cards" ($current | append $newCard) -}}
{{- /* Validate that the parent is card-section and under 3 cards */ -}}
{{- if (eq .Parent.Name "card-section") -}}
  <div class="card-container {{ if eq $isFeatured "true" }}featured-card{{ end }}" data-mf="true" style="display: none;">
    {{- if $title -}}
      <div class="card-header">
        {{- if $brandIcon -}}
          <img class="card-brand-icon" src="/images/icons/{{ $brandIcon }}.svg">
        {{- else -}}
          {{- if $icon -}}
            {{ partial "lucide" (dict "context" . "icon" $icon) }}
          {{- end -}}
        {{- end -}}
        {{- if $titleUrl -}}
          <h2 class="card-title"><a href="{{- printf "%s%s" .Page.Permalink $titleUrl -}}">{{- $title -}}</a></h2>
        {{- else -}}
          <h2 class="card-title">{{- $title -}}</h2>
        {{- end -}}
      </div>
    {{- else -}}
      {{ errorf "Mainframe: Missing param 'title'" }}
    {{- end -}}
    <p>{{- .Inner -}}</p>
  </div>
  <div class="col-md-5 card" data-mf="false">
    <div class="card-body">
      <h3 class="card-title" style="display: flex; align-items: center; gap: 5px;">
        {{- if $brandIcon -}}
          <img class="card-img-top" src="{{ .Site.BaseURL }}/images/icons/{{ $brandIcon }}.png"/>
        {{- else -}}
          <i class="fas fa-file-alt fa-lg card-img-top"></i>
        {{- end -}}
        {{- if ($title) -}}
          <a href="{{- $titleUrl -}}">{{- $title -}}</a>
        {{- else -}}
          {{ errorf "Old theme: Missing param 'title'" }}
        {{- end -}}
      </h3>
      <p>{{- .Inner -}}</p>
    </div>
  </div>
{{- else -}}
  {{ errorf "The '<card>' must be nested directly inside the shortcode '<card-section>'. Please see the exampleSite for an example of usage." }}
{{- end -}}